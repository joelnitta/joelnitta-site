---
title: Querying the NARA database
author: Joel Nitta
date: '2018-08-11'
slug: querying-the-nara-database
summary: Fun with U.S. Gov't-issued APIs!
categories:
  - R
  - tidyverse
tags:
  - JSON
  - API
  - National Archives and Records Administration
header:
  caption: 'Image Credit: [NPS.gov](https://www.nps.gov/orgs/1260/archives.htm)'
  image: 'querying-the-nara-database.png'
  preview_only: false
image:
  caption: ''
  focal_point: 'top'
  preview_only: true
output:
  blogdown::html_page:
    toc: true
    toc_depth: 2
    css: "/css/summarytools.css"
reading_time: false
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/pymjs/pym.v1.js"></script>
<script src="/rmarkdown-libs/widgetframe-binding/widgetframe.js"></script>
  <link rel="stylesheet" href="/css/summarytools.css" type="text/css" />

<div id="TOC">
<ul>
<li><a href="#tldr">TL;DR</a></li>
<li><a href="#what-is-the-nara-api">What is the NARA API?</a></li>
<li><a href="#set-up">Set-up</a></li>
<li><a href="#data-import">Data Import</a></li>
<li><a href="#data-tidying">Data Tidying</a></li>
<li><a href="#inspecting-the-data">Inspecting the Data</a></li>
</ul>
</div>

<!-- use a scroll box for wide output -->
<!-- https://stackoverflow.com/questions/36845178/width-of-r-code-chunk-output-in-rmarkdown-files-knitr-ed-to-html -->
<style>
pre {
  overflow-x: auto;
}
pre code {
  word-wrap: normal;
  white-space: pre;
}
</style>
<style type="text/css">
 img {   background-color:transparent;   border:0; }  table.st-table > thead > tr {    background-color: #eeeeee; }  table.st-table th {   text-align: center; }  table.st-table td span {   display: block; }  .st-container {   width: 100%;   padding-right: 15px;   padding-left: 15px;   margin-right: auto;   margin-left: auto;   margin-top: 15px; }  .st-multiline {   white-space: pre; }  .st-table {     width: auto;     table-layout: auto;     margin-top: 20px;     margin-bottom: 20px;     max-width: 100%;     background-color: transparent;     border-collapse: collapse; }  .st-table > thead > tr > th, .st-table > tbody > tr > th, .st-table > tfoot > tr > th, .st-table > thead > tr > td, .st-table > tbody > tr > td, .st-table > tfoot > tr > td {   vertical-align: middle; }  .st-table-bordered {   border: 1px solid #bbbbbb; }  .st-table-bordered > thead > tr > th, .st-table-bordered > tbody > tr > th, .st-table-bordered > tfoot > tr > th, .st-table-bordered > thead > tr > td, .st-table-bordered > tbody > tr > td, .st-table-bordered > tfoot > tr > td {   border: 1px solid #cccccc; }  .st-table-bordered > thead > tr > th, .st-table-bordered > thead > tr > td, .st-table thead > tr > th {   border-bottom: none; }  .st-table td, .st-table th {   padding: 8px; }  .st-table > thead > tr {    background-color: #eeeeee; }  .st-table-bordered > thead > tr > th, .st-table-bordered > tbody > tr > th, .st-table-bordered > thead > tr > td, .st-table-bordered > tbody > tr > td {   border: 1px solid #cccccc; }   .st-table-striped > tbody > tr:nth-of-type(odd) {   background-color: #ffffff; }  .st-table-striped > tbody > tr:nth-of-type(even) {   background-color: #f8f8f8; }  .st-table-striped > tbody > tr:nth-of-type(odd) {   background-color: #ffffff; }  .st-table-striped > tbody > tr:nth-of-type(even) {   background-color: #f9f9f9; }   .st-descr-table > thead > tr > th, .st-descr-table > tbody > tr > th, .st-descr-table > tfoot > tr > th, .st-descr-table > thead > tr > td, .st-descr-table > tbody > tr > td, .st-descr-table > tfoot > tr > td {   padding-left:  24px;   padding-right: 24px;   word-wrap: break-word; }  .st-descr-table td {   text-align: right; }  .st-freq-table, .st-freq-table-nomiss, .st-cross-table {   border: medium none; }  .st-freq-table  > thead > tr:nth-child(1) > th:nth-child(1), .st-cross-table > thead > tr:nth-child(1) > th:nth-child(1), .st-cross-table > thead > tr:nth-child(1) > th:nth-child(3) {   border:none;   background-color: #ffffff;   text-align: center; }  .st-freq-table > thead > tr > th, .st-freq-table > tbody > tr > th, .st-freq-table > tfoot > tr > th, .st-freq-table > thead > tr > td, .st-freq-table > tbody > tr > td, .st-freq-table > tfoot > tr > td, .st-freq-table-nomiss > thead > tr > th, .st-freq-table-nomiss > tbody > tr > th, .st-freq-table-nomiss > tfoot > tr > th, .st-freq-table-nomiss > thead > tr > td, .st-freq-table-nomiss > tbody > tr > td, .st-freq-table-nomiss > tfoot > tr > td, .st-cross-table > thead > tr > th, .st-cross-table > tbody > tr > th, .st-cross-table > tfoot > tr > th, .st-cross-table > thead > tr > td, .st-cross-table > tbody > tr > td, .st-cross-table > tfoot > tr > td {   padding-left:  20px;   padding-right: 20px; }   .st-protect-top-border {   border-top:1px solid #cccccc !important; }  .st-cross-table td {   text-align: center; }  .st-small {   font-size: 13px; }  .st-small td, .st-small th {   padding: 8px; }  .st-small > thead > tr > th, .st-small > tbody > tr > th, .st-small > tfoot > tr > th, .st-small > thead > tr > td, .st-small > tbody > tr > td, .st-small > tfoot > tr > td {   padding-left:  12px;   padding-right: 12px; } </style>
<div id="tldr" class="section level2">
<h2>TL;DR</h2>
<ul>
<li>NARA is the U.S. national records archive with &gt;100 terabytes of data and an open API</li>
<li>The data are deeply nested and a pain to navigate</li>
<li>I show how to extract and tidy the useful bits</li>
</ul>
</div>
<div id="what-is-the-nara-api" class="section level2">
<h2>What is the NARA API?</h2>
<p>NARA is the <a href="https://www.archives.gov/">The U.S. National Archives and Records Administration</a>. According to the <a href="https://www.archives.gov/publications/general-info-leaflets/1-about-archives.html">website</a>, the NARA collection includes:</p>
<blockquote>
<p>‚Äúapproximately 10 billion pages of textual records; 12 million maps, charts, and architectural and engineering drawings; 25 million still photographs and graphics; 24 million aerial photographs; 300,000 reels of motion picture film; 400,000 video and sound recordings; and 133 terabytes of electronic data.‚Äù</p>
</blockquote>
<p>In other words, if you‚Äôre interested in big data, this is your kind of place! Traditionally, most ‚Äúrecords‚Äù were physical objects stored in archives, but these days NARA is getting better and better about digitazation and open access. I only know this because a certain somebody who does a lot of research in the archives said to me the other day ‚ÄúHey, NARA says they have an <a href="https://github.com/usnationalarchives/Catalog-API">API</a>. What can we do with that?‚Äù ü§î</p>
<p>This person happens to be researching the <a href="https://en.wikipedia.org/wiki/Internment_of_Japanese_Americans">internment of Japanese Americans during WWII</a>. The main U.S. government agency involved in this regrettable activity was the <a href="https://en.wikipedia.org/wiki/War_Relocation_Authority">War Relocation Authority</a>.</p>
<p>Googling failed to turn up any existing R package to interface with the NARA API, despite its hugeness. Look like it‚Äôs time to roll up our sleeves and get our hands dirty‚Ä¶</p>
<p>Let‚Äôs query ‚Äúwar relocation authority‚Äù on the NARA API, get those data into R, and see what they have to say!</p>
</div>
<div id="set-up" class="section level2">
<h2>Set-up</h2>
<pre class="r"><code>library(tidyverse)
library(jsonlite)
library(listviewer)</code></pre>
</div>
<div id="data-import" class="section level2">
<h2>Data Import</h2>
<p>NARA has an open API, with the base URL <a href="https://catalog.archives.gov/api/v1" class="uri">https://catalog.archives.gov/api/v1</a>. The <a href="https://github.com/usnationalarchives/Catalog-API/blob/master/search_and_export.md">github documentation</a> has a very helpful explanation of how to query the API, as well as a <a href="https://catalog.archives.gov/interactivedocumentation">sandbox</a> to test things out. Here, we are going to restrict our results to just ‚Äúitems‚Äù, which <a href="https://www.archives.gov/research/data-model/">according to NARA‚Äôs data model</a> are:</p>
<blockquote>
<p>‚ÄúThe smallest intellectually indivisible archival unit (e.g.¬†a letter, memorandum, report, leaflet, or photograph).‚Äù</p>
</blockquote>
<p>If we were not to do so, the search would also turn up loads of metadata including bits of <code>.gov</code> websites, collections of items, etc. We specify our query terms with <code>q=war%20relocation%20authority</code> and filter by the ‚Äúitem‚Äù result type with <code>resultTypes=item</code>.</p>
<pre class="r"><code>initial_search &lt;- jsonlite::fromJSON(&quot;https://catalog.archives.gov/api/v1?&amp;q=war%20relocation%20authority&amp;resultTypes=item&quot;, simplifyVector = FALSE)</code></pre>
<p>How are the data structured? Let‚Äôs look at the top 3 levels to get started.</p>
<pre class="r"><code>str(initial_search, max.level = 3)</code></pre>
<pre><code>List of 1
 $ opaResponse:List of 4
  ..$ @status: chr &quot;200&quot;
  ..$ time   : chr &quot;2019-04-12T00:03:56.794Z&quot;
  ..$ request:List of 5
  .. ..$ format     : chr &quot;json&quot;
  .. ..$ pretty     : logi TRUE
  .. ..$ action     : chr &quot;search&quot;
  .. ..$ q          : chr &quot;war%20relocation%20authority&quot;
  .. ..$ resultTypes: chr &quot;item&quot;
  ..$ results:List of 5
  .. ..$ queryTime: int 58
  .. ..$ total    : int 5737
  .. ..$ offset   : int 0
  .. ..$ rows     : int 10
  .. ..$ result   :List of 10</code></pre>
<p>We see that everything is contained in a single list item, which is unnamed. Not sure what the purpose of that is. üòï</p>
<p>Drilling down a bit, <code>$opaResponse</code> contains <code>$request</code>, which holds metadata about our query. <code>$opaResponse</code> also contains <code>$results</code>, which sounds more like what we‚Äôre interested in!</p>
<p>Notice that we had 5737 total results, but only 10 items in <code>$results$result</code>. This is because the default API query only returns that top 10 results. Now that we know how many results to expect, let‚Äôs specify that in a ‚Äúreal‚Äù query. In the API, we can indicate the maximum number of results to return (up to 10,000) with <code>rows=</code>. Note that this one will take much longer to download.</p>
<pre class="r"><code># Wait a minute so we don&#39;t overload the API with requests
Sys.sleep(60)

# Get number of rows to download from initial results
n_rows &lt;- initial_search[[&quot;opaResponse&quot;]][[&quot;results&quot;]][[&quot;total&quot;]]

# Set a timer
start_time &lt;- Sys.time()

# Call the API, specifying the total number of rows from the results of the initial search
json_raw &lt;- jsonlite::fromJSON(glue::glue(&quot;https://catalog.archives.gov/api/v1?&amp;q=war%20relocation%20authority&amp;resultTypes=item&amp;rows={n_rows}&quot;), simplifyVector = FALSE)

# See how long it took
finish_time &lt;- Sys.time()
finish_time - start_time</code></pre>
<pre><code>Time difference of 31.86166 mins</code></pre>
<p>From our glimpse into the structure of the initial results, we know that the data we‚Äôre interested in are nested down in <code>$opaResponse$results$result</code>. Let‚Äôs extract those as <code>json_data</code>.</p>
<pre class="r"><code>json_data &lt;- json_raw$opaResponse$results$result
nresults &lt;- length(json_data)
nresults</code></pre>
<pre><code>[1] 5591</code></pre>
<p>OK, so how are the ‚Äúreal‚Äù results structured? There‚Äôs no way to check each one, so let‚Äôs grab 10 randomly and have a look.</p>
<pre class="r"><code>set.seed(3098) # for reproducibility
jsonedit(json_data[sample(1:nresults, 10)])</code></pre>
<div id="htmlwidget-1" style="width:100%;height:350px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"url":"/post/querying-the-nara-database/index_files/figure-html//widgets/widget_real-query-structure.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>It looks like they have a more-or-less shared structure (6‚Äì7 items each), so we <em>should</em> be able to wrangle them into something more tidy.</p>
</div>
<div id="data-tidying" class="section level2">
<h2>Data Tidying</h2>
<p>The number of headaches this induces depends on how deeply nested the items are. We‚Äôll start easy.</p>
<div id="level-1-beginner" class="section level3">
<h3>Level 1: Beginner</h3>
<p>Within <code>json_data</code>, each item contains just a few items that don‚Äôt contain nested lists. We can just use these directly to start building our tidy dataframe. Forunately, none of these contain null values, so we don‚Äôt have to deal with that headache. For details on this and other more advanced ways to build tidy dataframes from JSON lists, see <a href="https://jennybc.github.io/purrr-tutorial/ex26_ny-food-market-json.html">Jenny Bryan‚Äôs excellent purrr tutorial</a>.</p>
<pre class="r"><code>simple_cols &lt;- c(&quot;naId&quot;, &quot;type&quot;, &quot;score&quot;)

tidy_data &lt;- json_data %&gt;% 
  map_df(`[`, simple_cols)

tidy_data %&gt;% head</code></pre>
<pre><code># A tibble: 6 x 3
  naId    type         score
  &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt;
1 536874  description 0.0585
2 536878  description 0.0585
3 536259  description 0.0502
4 7820143 description 0.0489
5 536863  description 0.0433
6 536298  description 0.0433</code></pre>
</div>
<div id="level-2-intermediate" class="section level3">
<h3>Level 2: Intermediate</h3>
<p>Most of the bits of data we are interested in are nested further down in the list though, so this approach won‚Äôt work for those. Instead, we will use <code>purrr::pluck()</code>, which as the name suggests ‚Äúplucks‚Äù more deeply nested elements out of the list.</p>
<p>To see how this works, let‚Äôs start with a single element of the JSON data that we want to turn into a column in our tidy dataframe. Take for example, the ‚ÄúscopeAndContentNote‚Äù field. This appears to contain photo captions, which could be quite interesting.</p>
<p>By examining the JSON data, we see ‚ÄúscopeAndContentNote‚Äù is nested within ‚Äúitem‚Äù, which is nested within ‚Äúdescription‚Äù. We can use these as input into <code>pluck</code> to extract just this element. As the docs for <code>pluck</code> say, ‚Äúif your accessors are stored in a list, you can splice that in with !!!‚Äù. Let‚Äôs try that just for the first record:</p>
<pre class="r"><code>scopeAndContentNote_location &lt;- list(&quot;description&quot;, &quot;item&quot;, &quot;scopeAndContentNote&quot;)

pluck(json_data, 1, !!!scopeAndContentNote_location)</code></pre>
<pre><code>[1] &quot;The full caption for this photograph reads: Manzanar Relocation Center, Manzanar, California. Pruning trees at this War Relocatin Authority center for evacuees of Japanese ancestry.\n&quot;</code></pre>
<p>Maybe we can map the <code>pluck</code> function over the whole list and thereby extract ‚ÄúscopeAndContentNote‚Äù?</p>
<pre class="r"><code>map_chr(json_data, ~ pluck(., !!!scopeAndContentNote_location))</code></pre>
<pre><code>Error: Result 4 must be a single string, not NULL of length 0</code></pre>
<p>Nope, this doesn‚Äôt work because this field is missing for the fourth item in the JSON data.</p>
<p>We can get around this by setting the <code>.default</code> argument of <code>pluck</code> to <code>NA</code> (Thanks to <a href="https://twitter.com/hadleywickham/status/1028967053875728384">Hadley Wickham for pointing this out!</a>)</p>
<pre class="r"><code>map_chr(json_data, ~ pluck(., !!!scopeAndContentNote_location, 
  .default = NA_character_)) %&gt;% head</code></pre>
<pre><code>[1] &quot;The full caption for this photograph reads: Manzanar Relocation Center, Manzanar, California. Pruning trees at this War Relocatin Authority center for evacuees of Japanese ancestry.\n&quot;          
[2] &quot;The full caption for this photograph reads: Manzanar Relocation Center, Manzanar, California. Lunchtime at Manzanar, a War Relocation Authority center for evacuees of Japanese ancestry.\n&quot;      
[3] &quot;The full caption for this photograph reads: Poston, Arizona. Constructing quarters for evacuees of Japanese ancestry at War Relocation Authority center on Colorado River Indian Reservation.\n&quot;  
[4] NA                                                                                                                                                                                                 
[5] &quot;The full caption for this photograph reads: Manzanar Relocation Center, Manzanar, California. Mealtime at Manzanar, a War Relocation Authority center for evacuees of Japanese ancestry.\n&quot;       
[6] &quot;The full caption for this photograph reads: Poston, Arizona. Barracks under construction at this War Relocation Authority center where evacuees of Japanese ancestry are spending the duration.\n&quot;</code></pre>
<p>There is still one potential problem to take care of before mapping <code>pluck</code> across the dataset: what if the element will try to <code>pluck</code> is itself a list with multiple elements? To get around this, let‚Äôs make a function to aggressively flatten lists and return a character vector of length one.</p>
<pre class="r"><code>collapse_list &lt;- function (x, collapse_char = &quot;; &quot;) {
  if (is.null(x)) {return (NA_character_)} # just in case
  if (is.list(x)) {
    unlist(x) %&gt;%
      paste(sep = &quot;_&quot;, collapse = collapse_char) -&gt; x
  }
  x
}</code></pre>
<p>Now we can use <code>pluck</code> in combination with <code>collapse_list</code> to extract this particular element from every result in <code>json_data</code>. Note the use of <code>~</code> to specify an anonymous function, with <code>.</code> to indicate the argument we‚Äôre mapping over.</p>
<pre class="r"><code>scopeAndContentNote &lt;- map_chr(
  json_data, ~ pluck(., !!!scopeAndContentNote_location, 
  .default = NA_character_) %&gt;% collapse_list)

scopeAndContentNote %&gt;% head</code></pre>
<pre><code>[1] &quot;The full caption for this photograph reads: Manzanar Relocation Center, Manzanar, California. Pruning trees at this War Relocatin Authority center for evacuees of Japanese ancestry.\n&quot;          
[2] &quot;The full caption for this photograph reads: Manzanar Relocation Center, Manzanar, California. Lunchtime at Manzanar, a War Relocation Authority center for evacuees of Japanese ancestry.\n&quot;      
[3] &quot;The full caption for this photograph reads: Poston, Arizona. Constructing quarters for evacuees of Japanese ancestry at War Relocation Authority center on Colorado River Indian Reservation.\n&quot;  
[4] NA                                                                                                                                                                                                 
[5] &quot;The full caption for this photograph reads: Manzanar Relocation Center, Manzanar, California. Mealtime at Manzanar, a War Relocation Authority center for evacuees of Japanese ancestry.\n&quot;       
[6] &quot;The full caption for this photograph reads: Poston, Arizona. Barracks under construction at this War Relocation Authority center where evacuees of Japanese ancestry are spending the duration.\n&quot;</code></pre>
<pre class="r"><code>scopeAndContentNote %&gt;% length</code></pre>
<pre><code>[1] 5591</code></pre>
<p>Cool! But how do we scale up to the rest of the elements we want to <code>pluck</code>?</p>
<p>First of all, we need an easy way to find the locations of the elements we are interested within this gaping black hole of a list. I manually typed in the (rather short) three levels to ‚ÄúscopeAndContentNote‚Äù, but I‚Äôd rather not do that for everything.</p>
<p>Here is where RStudio really shines, and it would be a much bigger pain without it. If you click on the <code>json_data</code> in the ‚ÄúEnvironment‚Äù tab, or just type <code>View(json_data)</code> in the console, you‚Äôll get a view of the nested list similar to that produced by <code>jsonedit()</code>. We can drill down through the nested list and identify the bits of data that matter. Once you find something that you want to keep, click the ‚Äúcopy‚Äù icon on the right side. This will copy the double-bracket code needed to grab that element to the console.</p>
<p>Here‚Äôs a twitter-view of how that works:</p>
{{% tweet 1025111258666692608 %}}
<p>That‚Äôs very handy, but unfortunately <code>pluck</code> needs the directions to the thing to <code>pluck</code> either as a function or a list, not a bunch of strings in brackets. So, here is a fairly hacky function to convert a line of strings in brackets to a list.</p>
<pre class="r"><code>brackets_to_list &lt;- function (x) {
  gsub(&quot;]][[&quot;, &quot;_&quot;, x, fixed = TRUE) %&gt;%
    gsub(&quot;[[&quot;, &quot;&quot;, ., fixed = TRUE) %&gt;%
    gsub(&quot;]]&quot;, &quot;&quot;, ., fixed = TRUE) %&gt;%
    gsub(&#39;\&quot;&#39;, &quot;&quot;, ., fixed = TRUE) %&gt;%
    stringr::str_split(&quot;_&quot;) %&gt;%
    purrr::flatten()
}

title_location &lt;- &#39;[[&quot;description&quot;]][[&quot;item&quot;]][[&quot;title&quot;]]&#39;

brackets_to_list(title_location)</code></pre>
<pre><code>[[1]]
[1] &quot;description&quot;

[[2]]
[1] &quot;item&quot;

[[3]]
[1] &quot;title&quot;</code></pre>
<pre class="r"><code>pluck(json_data, 1, !!!brackets_to_list(title_location))</code></pre>
<pre><code>[1] &quot;Manzanar Relocation Center, Manzanar, California. Pruning trees at this War Relocatin Authority cen . . .&quot;</code></pre>
<p>We can now (finally) start scaling up by copying the ‚Äúaddresses‚Äù from RStudio‚Äôs list viewer into a list, then mapping that list onto <code>brackets_to_list</code>. Note that the ‚Äúaddresses‚Äù must be copied within single brackets (I‚Äôm pretty sure there‚Äôs a <code>tidyeval</code> way around this but haven‚Äôt figured it out yet‚Ä¶ comments welcome).</p>
<pre class="r"><code>list(
  contributor = &#39;[[&quot;description&quot;]][[&quot;item&quot;]][[&quot;personalContributorArray&quot;]][[&quot;personalContributor&quot;]][[&quot;contributor&quot;]][[&quot;termName&quot;]]&#39;,
  scopeAndContentNote = &#39;[[&quot;description&quot;]][[&quot;item&quot;]][[&quot;scopeAndContentNote&quot;]]&#39;,
  records_type = &#39;[[&quot;description&quot;]][[&quot;item&quot;]][[&quot;generalRecordsTypeArray&quot;]][[&quot;generalRecordsType&quot;]][[&quot;termName&quot;]]&#39;,
  title = &#39;[[&quot;description&quot;]][[&quot;item&quot;]][[&quot;title&quot;]] &#39;,
  parent_series_title = &#39;[[&quot;description&quot;]][[&quot;item&quot;]][[&quot;parentSeries&quot;]][[&quot;title&quot;]]&#39;,
  start_date = &#39;[[&quot;description&quot;]][[&quot;item&quot;]][[&quot;parentSeries&quot;]][[&quot;inclusiveDates&quot;]][[&quot;inclusiveStartDate&quot;]][[&quot;year&quot;]]&#39;,
  end_date = &#39;[[&quot;description&quot;]][[&quot;item&quot;]][[&quot;parentSeries&quot;]][[&quot;inclusiveDates&quot;]][[&quot;inclusiveEndDate&quot;]][[&quot;year&quot;]]&#39;,
  creator = &#39;[[&quot;description&quot;]][[&quot;item&quot;]][[&quot;parentSeries&quot;]][[&quot;creatingOrganizationArray&quot;]][[&quot;creatingOrganization&quot;]][[&quot;creator&quot;]][[&quot;termName&quot;]]&#39;,
  thumbnail = &#39;[[&quot;objects&quot;]][[&quot;object&quot;]][[&quot;thumbnail&quot;]][[&quot;@url&quot;]]&#39;,
  record_group = &#39;[[&quot;description&quot;]][[&quot;item&quot;]][[&quot;parentSeries&quot;]][[&quot;parentRecordGroup&quot;]][[&quot;recordGroupNumber&quot;]]&#39;,
  archive = &#39;[[&quot;description&quot;]][[&quot;item&quot;]][[&quot;physicalOccurrenceArray&quot;]][[&quot;itemPhysicalOccurrence&quot;]][[&quot;locationArray&quot;]][[&quot;location&quot;]][[&quot;facility&quot;]][[&quot;termName&quot;]]&#39;
) %&gt;%
  map(brackets_to_list) -&gt; lookup_terms</code></pre>
<p>The next step is to map our anonymous plucking function (which works on one column) onto the full dataset (to go across all the columns). For this, we define a new function to pass to <code>map_df</code>. This nested mapping makes my head hurt, but it works. Note that the version here is restricted to character vectors, which works for this dataset, but may need to be changed for other cases. Again, <a href="https://jennybc.github.io/purrr-tutorial/ex26_ny-food-market-json.html">Jenny Bryan‚Äôs post</a> is the go-to.</p>
<pre class="r"><code>make_df &lt;- function (data, lookup_list, col_name) {
  sym_col_name &lt;- sym(col_name)
  map_chr(data, ~ pluck(., !!!lookup_list[[col_name]], 
                        .default = NA_character_) %&gt;% collapse_list) %&gt;% 
    tibble %&gt;% select(!!sym_col_name := .)
}</code></pre>
<p>Use <code>map_dfc</code> to bind the results by column, not row.</p>
<pre class="r"><code>other_cols &lt;- map_dfc(
  names(lookup_terms), 
  make_df, 
  data = json_data, 
  lookup_list = lookup_terms)

other_cols %&gt;% head</code></pre>
<pre><code># A tibble: 6 x 11
  contributor scopeAndContent‚Ä¶ records_type title parent_series_t‚Ä¶
  &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;           
1 Albers, Cl‚Ä¶ &quot;The full capti‚Ä¶ Photographs‚Ä¶ &lt;NA&gt;  Central Photogr‚Ä¶
2 Albers, Cl‚Ä¶ &quot;The full capti‚Ä¶ Photographs‚Ä¶ &lt;NA&gt;  Central Photogr‚Ä¶
3 Albers, Cl‚Ä¶ &quot;The full capti‚Ä¶ Photographs‚Ä¶ &lt;NA&gt;  Central Photogr‚Ä¶
4 &lt;NA&gt;        &lt;NA&gt;             Textual Rec‚Ä¶ &lt;NA&gt;  Construction Co‚Ä¶
5 Albers, Cl‚Ä¶ &quot;The full capti‚Ä¶ Photographs‚Ä¶ &lt;NA&gt;  Central Photogr‚Ä¶
6 Clark, Fre‚Ä¶ &quot;The full capti‚Ä¶ Photographs‚Ä¶ &lt;NA&gt;  Central Photogr‚Ä¶
# ‚Ä¶ with 6 more variables: start_date &lt;chr&gt;, end_date &lt;chr&gt;,
#   creator &lt;chr&gt;, thumbnail &lt;chr&gt;, record_group &lt;chr&gt;, archive &lt;chr&gt;</code></pre>
</div>
<div id="level-3-facepalm" class="section level3">
<h3>Level 3: Facepalm</h3>
<p>Great, we‚Äôre <em>almost</em> there. There‚Äôs one last tricky list element to tackle: user-contributed tags. This one also looks quite interesting for data analysis, so I want to be sure to include it. These are tags that anybody can add to the database either through the UI or the API. Unfortunately they are‚Ä¶ (you guessed it) a deeply nested list! We can find their location through my now tried-and-true paste from RStudio viewer method.</p>
<pre class="r"><code>tag_location &lt;- brackets_to_list(&#39;[[&quot;publicContributions&quot;]][[&quot;tags&quot;]][[&quot;tag&quot;]]&#39;)</code></pre>
<p>Let‚Äôs extract these up into their own list to at least remove some layers of complexity.</p>
<pre class="r"><code>tag_list &lt;- map(json_data, ~ pluck(., !!!tag_location, .default = NA_character_)) 
jsonedit(tag_list[1:10])</code></pre>
<div id="htmlwidget-2" style="width:100%;height:350px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"url":"/post/querying-the-nara-database/index_files/figure-html//widgets/widget_tag-list.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>Two things are immediately obvious: some items have many tags, and some have none. For example, the first item has 17 tags. But it‚Äôs not that easy‚Ä¶ the tags themselves (indicated by the name ‚Äú$‚Äù) are contained within nested lists that also contain other metadata.</p>
<p>To extract just the tags, which are located one level down within each item, we use another mind-bending nested map. We then collapse down the resulting character vectors into a single-length vector each by mapping <code>paste()</code>.</p>
<pre class="r"><code>mult_tags &lt;- map(tag_list, 
  ~ map_chr(., ~pluck(., &quot;$&quot;, .default = NA_character_) %&gt;% collapse_list)) %&gt;%
  map_chr(paste, collapse = &quot;, &quot;)

mult_tags %&gt;% head</code></pre>
<pre><code>[1] &quot;World Ward II, WWII, War, Homefront, Internment Camp, Japanese American, Tree Climbing, Pruning, Man, Manzanar Relocation Center, Manzanar, California, War Relocation Authority, WRA, 1942, Clem Albers, Internees&quot;                         
[2] &quot;Manzanar Relocation Center, Manzanar, California, Lunchtime, Meal, WRA, War Relocation Authority, Internment Camp, Japanese American, Civilian, WWII, World Ward II, War, Homefront, Clem Albers, 1942&quot;                                      
[3] &quot;Japanese Internment Camp, World War II, WWII, War, Homefront, Construction, Colorado River Indian Reservation, 1942, Arizona, Poston, Parker, Barrack Construction, Clem Albers, WRA, War Relocation Authority, Poston War Relocation Center&quot;
[4] &quot;Jerome County, Idaho, construction directives, Japanese, climate, housing, military police, barracks, hospital, sanitation, administration, utilities, costs, photographs, maps, jwric-ts1&quot;                                                  
[5] &quot;NA&quot;                                                                                                                                                                                                                                          
[6] &quot;NA&quot;                                                                                                                                                                                                                                          </code></pre>
<p>I called these ‚Äúmult_tags‚Äù because each contain more than one tag. It turns out items with only one tag lack a level of nestedness. We want these too, but don‚Äôt need to use the nested map for them.</p>
<pre class="r"><code>single_tags &lt;- map_chr(tag_list, ~pluck(., &quot;$&quot;, .default = NA_character_) %&gt;% collapse_list)

single_tags[!is.na(single_tags)] %&gt;% head</code></pre>
<pre><code>[1] &quot;water tower&quot;       &quot;Japanese&quot;          &quot;construction&quot;     
[4] &quot;cots&quot;              &quot;ArchivesGameNight&quot; &quot;MRC-tg1&quot;          </code></pre>
<p>Now, we can finally combine both sets of tags into the final vector.</p>
<pre class="r"><code>tags &lt;- coalesce(single_tags, mult_tags)</code></pre>
<p>That <code>paste(collapse)</code> left a bunch of <code>&quot;&quot;</code> elements in our vector though. Let‚Äôs convert those to proper <code>NA</code>.</p>
<pre class="r"><code>tags &lt;- map_chr(tags, function (x) if (x == &quot;&quot;) {NA_character_} else {x})</code></pre>
<p>Now we can combine these with the ‚Äúsimple‚Äù columns into our tidy dataframe.</p>
<pre class="r"><code>tidy_data &lt;- bind_cols(tidy_data, other_cols, tags = tags)

# Save our data so we can use it for analysis in the next blog post
readr::write_csv(tidy_data, &quot;nara_data.csv&quot;)

tidy_data %&gt;% head</code></pre>
<pre><code># A tibble: 6 x 15
  naId  type   score contributor scopeAndContent‚Ä¶ records_type title
  &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt;
1 5368‚Ä¶ desc‚Ä¶ 0.0585 Albers, Cl‚Ä¶ &quot;The full capti‚Ä¶ Photographs‚Ä¶ &lt;NA&gt; 
2 5368‚Ä¶ desc‚Ä¶ 0.0585 Albers, Cl‚Ä¶ &quot;The full capti‚Ä¶ Photographs‚Ä¶ &lt;NA&gt; 
3 5362‚Ä¶ desc‚Ä¶ 0.0502 Albers, Cl‚Ä¶ &quot;The full capti‚Ä¶ Photographs‚Ä¶ &lt;NA&gt; 
4 7820‚Ä¶ desc‚Ä¶ 0.0489 &lt;NA&gt;        &lt;NA&gt;             Textual Rec‚Ä¶ &lt;NA&gt; 
5 5368‚Ä¶ desc‚Ä¶ 0.0433 Albers, Cl‚Ä¶ &quot;The full capti‚Ä¶ Photographs‚Ä¶ &lt;NA&gt; 
6 5362‚Ä¶ desc‚Ä¶ 0.0433 Clark, Fre‚Ä¶ &quot;The full capti‚Ä¶ Photographs‚Ä¶ &lt;NA&gt; 
# ‚Ä¶ with 8 more variables: parent_series_title &lt;chr&gt;, start_date &lt;chr&gt;,
#   end_date &lt;chr&gt;, creator &lt;chr&gt;, thumbnail &lt;chr&gt;, record_group &lt;chr&gt;,
#   archive &lt;chr&gt;, tags &lt;chr&gt;</code></pre>
<p>Phew!üòì Finally all tidy.</p>
</div>
</div>
<div id="inspecting-the-data" class="section level2">
<h2>Inspecting the Data</h2>
<p>Let‚Äôs get an overview of some of the data.</p>
<pre class="r"><code>tidy_data %&gt;%
select(archive, records_type, contributor, record_group, tags) %&gt;%
summarytools::dfSummary(graph.magnif = .75) %&gt;%
print(method = &quot;render&quot;, headings = FALSE)</code></pre>
<div class="container st-container"><table class="table table-striped table-bordered st-table st-table-striped st-table-bordered st-multiline ">
  <thead>
    <tr>
      <th align="center" class="variable st-protect-top-border"><strong>Variable</strong></th>
      <th align="center" class="stats.values st-protect-top-border"><strong>Stats / Values</strong></th>
      <th align="center" class="freqs.pct.valid st-protect-top-border"><strong>Freqs (% of Valid)</strong></th>
      <th align="center" class="graph st-protect-top-border"><strong>Graph</strong></th>
      <th align="center" class="missing st-protect-top-border"><strong>Missing</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td align="left">archive
[character]</td>
      <td align="left">1. National Archives at Coll
2. Electronic Records Archiv
3. NARA's Rocky Mountain Reg
4. National Archives Buildin
5. Harry S. Truman Library (
6. Ronald Reagan Library (Si
7. Franklin D. Roosevelt Lib
8. NARA's Pacific Region (Ri
9. NARA's Pacific Region (Sa
10. NARA's Southeast Region (
[ 4 others ]</td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">3982</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">71.5%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">1527</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">27.4%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">22</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.4%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">12</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.2%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">8</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.1%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">4</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.1%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">2</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.0%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">2</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.0%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">2</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.0%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">2</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.0%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">4</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.1%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent"><img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAF0AAADPCAQAAAA91hUAAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfjBAwSBA3mLRRTAAABQUlEQVR42u3XO67CQBBFQQ9iocSP9UDsnUJqPwkkPnLfNnUyJ6iEOpg7blPXDtUA9F4dlx/X+MP/Gw/o03Sqtj1tXn01Phh0dPT40NHR40Ov6N/Lca72vNBYPtHH2z+zVUtt44NpTF/d+uWjgXfe+N6+NvDmbd1T64NBR0ePDx0dPT70igy8rdrjwPtsJZXSe4WOjh4fOjp6fOjov0K3kiqyktDR40NHR48PHR09vsZ0K6kiKwkdPT50dPT40NHR42tMt5Iq2gvdwENHTwwdHT0+dHT0+BrTDbyKrCR09PjQ0dHjQ0dHj68x3UqqyEpCR48PHR09PnR09Pga062kivZCN/DQ0RNDR0ePDx0dPb7GdAOvIisJHT0+dHT0+NDR0eNrTLeSKrKS0NHjQ0dHjw8dHT2+xvTR6om+qvG/jl7RHX8MLQduJcKXAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTA0LTEyVDA5OjA0OjEzKzA5OjAwM0gB1gAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0wNC0xMlQwOTowNDoxMyswOTowMEIVuWoAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAkdEVYdGljYzptYW51ZmFjdHVyZXIAR2VuZXJpYyBSR0IgUHJvZmlsZRw9aD4AAAAddEVYdGljYzptb2RlbABHZW5lcmljIFJHQiBQcm9maWxl6m+uqwAAAABJRU5ErkJggg=="></td>
      <td align="center">24
(0.43%)</td>
    </tr>
    <tr>
      <td align="left">records_type
[character]</td>
      <td align="left">1. Photographs and other Gra
2. Textual Records</td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">3965</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">71.2%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">1604</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">28.8%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent"><img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAFwAAAAtCAQAAACJmMS3AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfjBAwSBA3mLRRTAAAAi0lEQVRo3u3XMQqAMBBE0ax4UGs9j9a5qbaJoASVzY7836WRV0zh2p40G3oDgKs0lo8t+OBnu4CnNPW23ZSrl+xUgAMHHjTgwIEHDTjwxk6/tbm3pzkrbwd7/BmfSqvsVGTh1cbX1zfn4ra2T2/O7KVOwlMBDhx40IADBx404MAb+8fNqZTsVIB7dwAYNwuh/0bWUAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0wNC0xMlQwOTowNDoxMyswOTowMDNIAdYAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMDQtMTJUMDk6MDQ6MTMrMDk6MDBCFblqAAAAPXRFWHRpY2M6Y29weXJpZ2h0AENvcHlyaWdodCAyMDA3IEFwcGxlIEluYy4sIGFsbCByaWdodHMgcmVzZXJ2ZWQunmbcKQAAACN0RVh0aWNjOmRlc2NyaXB0aW9uAEdlbmVyaWMgUkdCIFByb2ZpbGUapziOAAAAJHRFWHRpY2M6bWFudWZhY3R1cmVyAEdlbmVyaWMgUkdCIFByb2ZpbGUcPWg+AAAAHXRFWHRpY2M6bW9kZWwAR2VuZXJpYyBSR0IgUHJvZmlsZepvrqsAAAAASUVORK5CYII="></td>
      <td align="center">22
(0.39%)</td>
    </tr>
    <tr>
      <td align="left">contributor
[character]</td>
      <td align="left">1. Albers, Clem
2. Clark, Fred, photographer
3. Cook, John
4. Iwasaki, Hikaru, 1923-
5. Lange, Dorothea, 1895-196
6. Lynn, Charles, War Reloca
7. Mace, Charles E., photogr
8. McClelland, Joe, War Relo
9. Parker, Tom
10. Stewart, Francis, War Rel
11. Van Tassel, Gretchen</td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">381</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">10.2%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">154</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">4.1%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">26</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.7%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">291</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">7.8%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">872</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">23.2%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">18</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.5%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">93</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">2.5%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">188</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">5.0%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">707</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">18.9%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">1002</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">26.7%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">18</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.5%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent"><img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAACsAAADPCAQAAADGgeDfAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfjBAwSBA3mLRRTAAABJUlEQVR42u3ZSw6DMAxF0VCxUOZdDx17p3REZWiSRvlQnnQ9o5+jYEWxHE9bGBGPIaoYO/uHVyLRz6mE8n+ej18tkZ/bfZIACwsL6+N0glkndvKnZNGxmgwvCed2/bxHWZkpZPeiY3dNAiwsLKwPis6ZXbe1U/entRNgYWFhL2C1qkOid9ijtofIXlhZ9Wq1dgIsLKwoS+8QflaHkohVkIJxRj4s+qnWBoOFhRVlqQ4Xsb2uq6STAAsLCzuG1So60ZakddT9tdqloikpYHsFLCwsrA9akpC5sGqrEIkLK2tcrdYGg4WFFWWpDuPY6ilJvihVTknsP0mAhYWF9UHRCV1m6LGXbZ6h72GHJ60NBgsLK8pSHc4sw25YWFjYa4bdt1+tFvsGqSg7WhBLybkAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMDQtMTJUMDk6MDQ6MTMrMDk6MDAzSAHWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTA0LTEyVDA5OjA0OjEzKzA5OjAwQhW5agAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBhbGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJHQiBQcm9maWxlGqc4jgAAACR0RVh0aWNjOm1hbnVmYWN0dXJlcgBHZW5lcmljIFJHQiBQcm9maWxlHD1oPgAAAB10RVh0aWNjOm1vZGVsAEdlbmVyaWMgUkdCIFByb2ZpbGXqb66rAAAAAElFTkSuQmCC"></td>
      <td align="center">1841
(32.93%)</td>
    </tr>
    <tr>
      <td align="left">record_group
[character]</td>
      <td align="left">1. 127
2. 142
3. 148
4. 210
5. 407
6. 46
7. 549
8. 77</td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">6</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.1%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">1</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.0%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">2</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.1%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">3965</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">99.7%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">1</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.0%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">1</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.0%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">1</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.0%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">1</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.0%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent"><img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAHwAAACYCAQAAACMwkWhAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfjBAwSBA3mLRRTAAABDklEQVR42u3aMQ6CQABFQTAc1EvZc1Nsd00sgYR5Y0Vs9gUp+HE9FtPr7gMUXvhFjuHzefgDP7ayd7xwTeGawjWFawrXFK4pXLOOr+Dr3ac52djK3vEp/OkLzN9wSeGawjWFawrXFK4pXFO4pgVG0wKjKVxTuKZwTeGawjWFawrXtMBo2PBtvHj89DQ8y9v8zfvuo51on67Yn3rhmsI1hWsK1xSuKVzz83a2332eyzQ9afrzj6ZwTeGawjWFawrXFK4pXNMCoyl8WZqeCIVrCtcUrilcU7imcE3hmqYnTQuMpnBN4ZrCNYVrCtcUrilc0wKjaYHRFK4pXFO4pnBN4ZrCNYVrVugVfMLe8cI1X4j7K1j5mkVSAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTA0LTEyVDA5OjA0OjEzKzA5OjAwM0gB1gAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0wNC0xMlQwOTowNDoxMyswOTowMEIVuWoAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAkdEVYdGljYzptYW51ZmFjdHVyZXIAR2VuZXJpYyBSR0IgUHJvZmlsZRw9aD4AAAAddEVYdGljYzptb2RlbABHZW5lcmljIFJHQiBQcm9maWxl6m+uqwAAAABJRU5ErkJggg=="></td>
      <td align="center">1613
(28.85%)</td>
    </tr>
    <tr>
      <td align="left">tags
[character]</td>
      <td align="left">1. NA
2. MRC-tg1
3. tghr-tg1
4. RoadTripDenver
5. Departure
6. jwric-ts1
7. labordaymappage
8. Japanese Internment
9. strawberries
10. american flag, pledge of [ 245 others ]</td>
      <td align="left" style="padding:0;vertical-align:middle"><table style="border-collapse:collapse;border:none;margin:0"><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">5246</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">93.8%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">31</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.6%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">20</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.4%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">9</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.2%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">8</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.1%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">5</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.1%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">5</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.1%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">4</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.1%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">3</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.1%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">2</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">0.0%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr><tr style="background-color:transparent"><td style="padding:0 5px 0 7px;margin:0;border:0" align="right">258</td><td style="padding:0 2px 0 0;border:0;" align="left">(</td><td style="padding:0;border:0" align="right">4.6%</td><td style="padding:0 4px 0 2px;border:0" align="left">)</td></tr></table></td>
      <td align="left" style="vertical-align:middle;padding:0;background-color:transparent"><img style="border:none;background-color:transparent;padding:0" src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAHYAAADPCAQAAACKa+0nAAAAAmJLR0QA/4ePzL8AAAAHdElNRQfjBAwSBA3mLRRTAAABZ0lEQVR42u3ZMU7DQABFQS/yQVPDeUjtm0JDYUdKQ7CMZt80yA3ap2wK/4yvZR5vVx+g2GJft+4f7uAX+H08iV2W29Vn+2Pb4Wmqa1ysqlhVsapiVcWqilU9vPVsV5/nVGP/Cjt+/W/+r33fVNd43thPcJZ5GqsrVlWsqlhVsapiVcWqilU1y6haKlTFqopVFasqVlWsqlhVsaqWClVLhapYVbGqYlXFqopVFasqVtVSoWqpUBWrKlZVrKpYVbGqYlXFqloqVPPGNstAilUVqypWVayqWFWxqmJVzTKqlgpVsapiVcWqilUVqypWVayqpULVUqEqVlWsqlhVsapiVcWqilW1VKjmjW2WgRSrKlZVrKpYVbGqYlXFqpplVC0VqmJVxaqKVRWrKlZVrKpYVUuFat0/7JeKD/BjXo+Pt5+/29XnOsVU17hYVbGqYlXFqopVFat6eOvZrj7PqQb+Y/vBVNe4WNU3JlItB1PgkPUAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMDQtMTJUMDk6MDQ6MTMrMDk6MDAzSAHWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTA0LTEyVDA5OjA0OjEzKzA5OjAwQhW5agAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBhbGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJHQiBQcm9maWxlGqc4jgAAACR0RVh0aWNjOm1hbnVmYWN0dXJlcgBHZW5lcmljIFJHQiBQcm9maWxlHD1oPgAAAB10RVh0aWNjOm1vZGVsAEdlbmVyaWMgUkdCIFByb2ZpbGXqb66rAAAAAElFTkSuQmCC"></td>
      <td align="center">0
(0%)</td>
    </tr>
  </tbody>
</table></div>
<p>Hmmm‚Ä¶ interesting! Even this broad overview is providing a fascinating peek into the dataset. The ‚Äúitems‚Äù are mostly photographs, with the remaining one-third or so documents. Most of the photographs were taken by just a handful of people, Dorothea Lange being one of the more prolific.</p>
<p>Whew, just tidying the JSON data took up the whole blogpost. Hopefully I can get to data analysis in the next one.</p>
<hr />
<p>Updated 2019-04-12</p>
<p><a href="https://github.com/joelnitta/joelnitta-site/blob/master/content/post/querying-the-nara-database/index.Rmd">source code</a></p>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 3.5.2 (2018-12-20)
Platform: x86_64-apple-darwin15.6.0 (64-bit)
Running under: macOS High Sierra 10.13.6

Matrix products: default
BLAS: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] listviewer_2.0.0   jsonlite_1.6       forcats_0.3.0     
 [4] stringr_1.4.0      dplyr_0.8.0.1      purrr_0.3.2       
 [7] readr_1.3.1        tidyr_0.8.1        tibble_2.1.1      
[10] ggplot2_3.1.0      tidyverse_1.2.1    widgetframe_0.3.1 
[13] htmlwidgets_1.3    summarytools_0.9.1 knitr_1.21        
[16] emo_0.0.0.9000    

loaded via a namespace (and not attached):
 [1] tidyselect_0.2.5   xfun_0.5           pander_0.6.2      
 [4] haven_1.1.2        lattice_0.20-38    colorspace_1.3-2  
 [7] htmltools_0.3.6    yaml_2.2.0         utf8_1.1.4        
[10] rlang_0.3.1        pillar_1.3.1       withr_2.1.2       
[13] glue_1.3.1         pryr_0.1.4         readxl_1.1.0      
[16] modelr_0.1.2       matrixStats_0.54.0 plyr_1.8.4        
[19] cellranger_1.1.0   munsell_0.5.0      blogdown_0.10.5   
[22] gtable_0.2.0       rvest_0.3.2        codetools_0.2-15  
[25] evaluate_0.13      curl_3.3           fansi_0.4.0       
[28] broom_0.5.0        Rcpp_1.0.1         backports_1.1.3   
[31] scales_1.0.0       checkmate_1.8.5    magick_1.9        
[34] rapportools_1.0    hms_0.4.2          digest_0.6.18     
[37] stringi_1.4.3      bookdown_0.9       grid_3.5.2        
[40] cli_1.1.0          tools_3.5.2        bitops_1.0-6      
[43] magrittr_1.5       RCurl_1.95-4.11    lazyeval_0.2.1    
[46] crayon_1.3.4       pkgconfig_2.0.2    xml2_1.2.0        
[49] lubridate_1.7.4    rstudioapi_0.9.0   assertthat_0.2.1  
[52] rmarkdown_1.11     httr_1.4.0         R6_2.4.0          
[55] nlme_3.1-137       compiler_3.5.2    </code></pre>
</div>
